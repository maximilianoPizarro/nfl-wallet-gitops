apiVersion: v1
kind: ConfigMap
metadata:
  name: nfl-wallet-dashboard-json
  namespace: observability
  labels:
    app.kubernetes.io/name: nfl-wallet-dashboard
    grafana_dashboard: "1"
data:
  json: |
    {"annotations":{"list":[]},"editable":true,"fiscalYearStartMonth":0,"graphTooltip":0,"id":null,"links":[],"liveNow":false,"panels":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"unit":"reqps"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":0},"id":1,"options":{"legend":{"displayMode":"list","placement":"bottom","showLegend":true}},"targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"expr":"sum(rate(istio_requests_total{destination_workload_namespace=~\"$namespace\", reporter=~\"source|destination\"}[5m])) by (destination_workload_namespace)","legendFormat":"{{ destination_workload_namespace }}","refId":"A"}],"title":"Request rate by environment","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"unit":"short"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":12,"y":0},"id":2,"options":{"legend":{"displayMode":"list","placement":"bottom","showLegend":true}},"targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"expr":"sum(rate(istio_requests_total{destination_workload_namespace=~\"$namespace\", reporter=~\"source|destination\", response_code=\"200\"}[5m])) by (destination_workload_namespace)","legendFormat":"{{ destination_workload_namespace }} 2xx","refId":"A"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"expr":"sum(rate(istio_requests_total{destination_workload_namespace=~\"$namespace\", reporter=~\"source|destination\", response_code=~\"4..\"}[5m])) by (destination_workload_namespace)","legendFormat":"{{ destination_workload_namespace }} 4xx","refId":"B"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"expr":"sum(rate(istio_requests_total{destination_workload_namespace=~\"$namespace\", reporter=~\"source|destination\", response_code=~\"5..\"}[5m])) by (destination_workload_namespace)","legendFormat":"{{ destination_workload_namespace }} 5xx","refId":"C"}],"title":"Response codes by environment","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"unit":"ms"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":8},"id":3,"options":{"legend":{"displayMode":"list","placement":"bottom","showLegend":true}},"targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"expr":"histogram_quantile(0.50, sum(rate(istio_request_duration_milliseconds_bucket{destination_workload_namespace=~\"$namespace\", reporter=~\"source|destination\"}[5m])) by (destination_workload_namespace, le))","legendFormat":"{{ destination_workload_namespace }} p50","refId":"A"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"expr":"histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{destination_workload_namespace=~\"$namespace\", reporter=~\"source|destination\"}[5m])) by (destination_workload_namespace, le))","legendFormat":"{{ destination_workload_namespace }} p99","refId":"B"}],"title":"Request duration by environment (p50, p99)","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"unit":"short"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":12,"y":8},"id":4,"options":{"legend":{"displayMode":"list","placement":"bottom","showLegend":true}},"targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"expr":"sum(increase(istio_requests_total{destination_workload_namespace=~\"$namespace\", reporter=~\"source|destination\"}[1h])) by (destination_workload_namespace)","legendFormat":"{{ destination_workload_namespace }}","refId":"A"}],"title":"Total requests (last 1h) by environment","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"percentunit"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":16},"id":5,"options":{"legend":{"displayMode":"list","placement":"bottom","showLegend":true}},"targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"expr":"sum(rate(istio_requests_total{destination_workload_namespace=~\"$namespace\", reporter=~\"source|destination\", response_code!=\"200\"}[5m])) by (destination_workload_namespace) / sum(rate(istio_requests_total{destination_workload_namespace=~\"$namespace\", reporter=~\"source|destination\"}[5m])) by (destination_workload_namespace)","legendFormat":"{{ destination_workload_namespace }} error rate","refId":"A"}],"title":"Error rate by environment","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"unit":"reqps"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":12,"y":16},"id":6,"options":{"legend":{"displayMode":"list","placement":"bottom","showLegend":true}},"targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"expr":"sum(rate(istio_requests_total{destination_workload_namespace=~\"$namespace\", reporter=~\"source|destination\"}[5m])) by (destination_workload_namespace, destination_service_name)","legendFormat":"{{ destination_workload_namespace }}/{{ destination_service_name }}","refId":"A"}],"title":"Request rate by environment and service","type":"timeseries"}],"refresh":"10s","schemaVersion":38,"style":"dark","tags":["nfl-wallet","istio","observability"],"templating":{"list":[{"current":{"selected":true,"text":"All","value":"$__all"},"hide":0,"includeAll":true,"label":"Environment (namespace)","multi":true,"name":"namespace","options":[{"selected":true,"text":"All","value":"$__all"},{"selected":false,"text":"nfl-wallet-dev","value":"nfl-wallet-dev"},{"selected":false,"text":"nfl-wallet-test","value":"nfl-wallet-test"},{"selected":false,"text":"nfl-wallet-prod","value":"nfl-wallet-prod"}],"query":"nfl-wallet-dev,nfl-wallet-test,nfl-wallet-prod","skipUrlSync":false,"type":"custom"},{"current":{"selected":false,"text":"Prometheus","value":"Prometheus"},"hide":0,"includeAll":false,"label":"Datasource","multi":false,"name":"datasource","options":[],"query":"prometheus","refresh":1,"regex":"","skipUrlSync":false,"type":"datasource"}]},"time":{"from":"now-1h","to":"now"},"timepicker":{},"timezone":"","title":"NFL Wallet - All environments (dev, test, prod)","uid":"nfl-wallet-all-environments","version":1,"weekStart":""}
