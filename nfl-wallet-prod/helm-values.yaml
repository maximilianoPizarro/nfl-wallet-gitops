# NFL Wallet - PROD (full profile: gateway, API keys, auth policy, rate limit, observability)
# Values under "nfl-wallet" so the dependency subchart receives them (Gateway + HTTPRoutes).
# Spec alignment: §5 hostname; §6 credentials + APP_ID header to backend; §7 metrics + consumer ratios; §8 tracing; §12 Blue/Green via route weights if supported.
# When using ACM ApplicationSet, clusterDomain and hosts are overridden via spec.source.helm.parameters.

nfl-wallet:
  clusterDomain: ""  # Override via ApplicationSet
  authPolicy:
    enabled: true
  namespaceMesh:
    enabled: true
  imageNamespace: maximilianopizarro

  apiCustomers:
    image: nfl-wallet-api-customers
    tag: latest
    persistence:
      enabled: true
  apiBills:
    image: nfl-api-bills
    tag: latest
    persistence:
      enabled: true
  apiRaiders:
    image: nfl-wallet-api-raiders
    tag: latest
    persistence:
      enabled: true

  webapp:
    image: nfl-wallet-webapp
    tag: latest
    route:
      enabled: false  # Un solo route: gateway sirve frontend + APIs (connectivity-link)
      # host = webapp-<namespace>.apps.<clusterDomain>
      host: ""  # Override via ApplicationSet
      tls:
        termination: edge
        insecureEdgeTerminationPolicy: Redirect
    apiCustomersUrl: ""
    apiBillsUrl: ""
    apiRaidersUrl: ""
    mobileAppDownloadUrl: ""

  waypoint:
    enabled: true
  # Gateway name for AuthPolicy and Blue/Green HTTPRoute (must match the Gateway resource created by the chart in this namespace).
  # Same name in nfl-wallet-test and nfl-wallet-prod is correct: they are two different Gateways (namespaced).
  gatewayPolicyGatewayName: "nfl-wallet-gateway"

  # Blue/Green (canary): HTTPRoute that splits traffic between prod and test. Use a dedicated hostname
  # (e.g. nfl-wallet-canary.apps...) so it does not conflict with the main prod route (nfl-wallet-prod.apps...).
  # If you use the same hostname as prod, this route can take over and cause 500 (wrong backends).
  blueGreen:
    enabled: true
    # hostname = nfl-wallet-canary.apps.<clusterDomain>
    hostname: ""  # Override via ApplicationSet: nfl-wallet-canary.apps.<clusterDomain>
    # prodWeight: 90   # % traffic to prod (default 90)
    # testWeight: 10  # % traffic to test / canary (default 10)

  # Spec §6: subscription model; defaults for testing (override via Sealed Secrets in prod)
  # apiKeys.enabled: false evita duplicado Secret con chart; kuadrantApiKeys crea secrets con labels para AuthPolicy
  apiKeys:
    enabled: false
    customers: "nfl-wallet-customers-key"
    bills: "nfl-wallet-bills-key"
    raiders: "nfl-wallet-raiders-key"
  kuadrantApiKeys:
    enabled: true
  gateway:
    enabled: true
    className: istio
    existingGatewayName: ""
    route:
      enabled: true
      # host = <namespace>.apps.<clusterDomain>
      host: ""  # Override via ApplicationSet
      serviceName: nfl-wallet-gateway-istio
      targetPort: http
    rateLimitBills:
      enabled: true
      permitLimit: 100
      fillIntervalSeconds: 60
    rateLimitPolicy:
      enabled: true
      bills:
        limit: 5
        window: 1m
        conditions: []
        counterExpressions: []

  # Spec §6: allow only valid credentials; global AuthorizationPolicy deny/allow by identity
  authorizationPolicy:
    enabled: true
    requireForCustomers: true
    requireForBills: true
    requireForRaiders: true

  topology:
    applicationName: nfl-wallet

  # Spec §7: traffic by API/path, response codes, latency, consumer ratios; §8: end-to-end tracing (W3C trace context)
  observability:
    rhobs:
      enabled: true
      namespace: openshift-cluster-observability-operator
      thanosQuerier:
        enabled: true
      podMonitorGateway:
        enabled: true
      serviceMonitorGateway:
        enabled: true
      uiPlugin:
        enabled: true
