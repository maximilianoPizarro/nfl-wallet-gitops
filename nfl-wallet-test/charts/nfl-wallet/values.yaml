# Default values for nfl-wallet
# Service/port layout: api-customers 8080, api-bills 8081, api-raiders 8082, webapp 5173

# Topology (OpenShift): application grouping and connectors in the Topology view
topology:
  applicationName: ""  # empty = nfl-wallet; set to override app.kubernetes.io/part-of
  # webapp shows connectors to api-customers, api-bills, api-raiders

global:
  imageRegistry: quay.io
  imagePullSecrets: []

# Override these if using a different Quay namespace
imageNamespace: maximilianopizarro

apiCustomers:
  image: nfl-wallet-api-customers
  tag: latest
  replicaCount: 1
  service:
    port: 8080  # Service port 8080, Pod targetPort 8080
  resources: {}
  persistence:
    enabled: true
    size: 1Gi

apiBills:
  image: nfl-api-bills
  tag: latest
  replicaCount: 1
  service:
    port: 8081  # Service port 8081, Pod targetPort 8080
  resources: {}
  persistence:
    enabled: true
    size: 1Gi

apiRaiders:
  image: nfl-wallet-api-raiders
  tag: latest
  replicaCount: 1
  service:
    port: 8082  # Service port 8082, Pod targetPort 8080
  resources: {}
  persistence:
    enabled: true
    size: 1Gi

webapp:
  image: nfl-wallet-webapp
  tag: latest
  replicaCount: 1
  service:
    port: 5173  # Service port 5173, Pod targetPort 8080
  resources: {}
  # OpenShift Route: set to false to disable autogenerated Route
  route:
    enabled: true
    # Optional: override host (default: webapp-<release-name>.<cluster-apps-domain>)
    host: ""
    tls:
      # Edge termination + redirect HTTP -> HTTPS
      termination: edge
      # Redirect: send HTTP to HTTPS; None or Allow
      insecureEdgeTerminationPolicy: Redirect
  # API base URLs (optional). Leave empty: webapp proxies /api-customers, /api-bills, /api-raiders to internal services.
  apiCustomersUrl: ""
  apiBillsUrl: ""
  apiRaidersUrl: ""
  # Optional: URL for "Download mobile app" in the browser (e.g. APK file or app store link). Leave empty to hide the link.
  mobileAppDownloadUrl: ""

# API key security: one key per API. Leave empty to disable validation (e.g. local dev).
apiKeys:
  enabled: false
  # Set in values or via --set; for production use a Secret (e.g. sealed-secrets). Keys are injected as env into each API.
  customers: ""
  bills: ""
  raiders: ""

# Gateway API (HTTPRoute connectivity). Enable when cluster has Gateway API + implementation (e.g. Istio, OpenShift Gateway).
gateway:
  enabled: false
  # Gateway class name (e.g. istio, openshift-gateway)
  className: istio
  # Optional: name of existing Gateway to attach HTTPRoutes to; if empty, a Gateway resource is created.
  existingGatewayName: ""
  # Hostnames for the gateway (e.g. OpenShift Route host). When using Kuadrant AuthPolicy/RateLimitPolicy, set this
  # so the AuthConfig gets the correct host and becomes "linked" (fixes "No hosts linked to the resource" / Enforced: False).
  # Example: ["nfl-gateway-nfl-wallet.apps.cluster-xxx.sandbox.opentlc.com"]
  hostnames: []
  # Rate limit for /api-bills at connectivity link (Istio EnvoyFilter on api-bills workload). No app code change.
  rateLimitBills:
    enabled: false
    permitLimit: 100
    fillIntervalSeconds: 60
  # Kuadrant RateLimitPolicy for /api-bills (targets HTTPRoute nfl-wallet-api-bills). Requires Kuadrant operator.
  rateLimitPolicy:
    enabled: false
    bills:
      limit: 100
      window: 1m
      # Optional: counter expressions (e.g. ["auth.identity.username"] for per-user; leave empty for global)
      counterExpressions: []
      # Optional: conditions (list of { operator, selector, value }); path condition is applied by default
      conditions:
        - operator: matches
          selector: request.path
          value: /api-bills
  # Kuadrant AuthPolicy for /api-bills: require X-API-Key header (OPA), custom 403 body. Requires Kuadrant operator.
  # When enabled, Istio AuthorizationPolicy for bills is not created (Kuadrant enforces at gateway).
  authPolicy:
    enabled: false
    bills:
      enabled: false
      # JSON body for 403 when X-API-Key is missing or empty
      unauthorizedBody: '{"error":"Forbidden","message":"Missing or invalid X-API-Key header."}'
  # Metrics: Prometheus scraping for gateway proxy (Total Requests, Success, Error Rate).
  # Prefer PodMonitor when the gateway Service does not expose the metrics port (15020/15090).
  metrics:
    # Scrapes gateway Pods directly (port 15020 on pod). Use when ServiceMonitor target is DOWN.
    podMonitor:
      enabled: true
      # Port on the gateway pod (Istio: 15020 = telemetry, 15090 = Envoy Prometheus)
      port: 15020
      path: /stats/prometheus
      interval: 30s
      selector: {}  # default: gateway.networking.k8s.io/gateway-name=nfl-wallet-gateway
    serviceMonitor:
      enabled: false
      serviceName: ""
      port: 15090
      path: /stats/prometheus
      interval: 30s
      selector: {}

  # OpenShift Route to expose the Gateway with Edge + Redirect (when gateway.enabled).
  # Set enabled: false if the platform already creates a gateway route (e.g. nfl-gateway -> nfl-wallet-gateway-istio)
  # so you only have one gateway URL.
  route:
    enabled: true
    name: ""   # default nfl-wallet-gateway; override to match platform route if needed
    host: ""
    tls:
      termination: edge
      insecureEdgeTerminationPolicy: Redirect
    # Service name to target; empty = nfl-wallet-gateway or existingGatewayName
    serviceName: ""
    # targetPort: named port (e.g. http) or number (e.g. 80) of the Gateway Service
    targetPort: http

# Istio AuthorizationPolicy: require X-API-Key header. Enable per API to secure wallet/APIs.
authorizationPolicy:
  enabled: false
  requireForCustomers: true
  requireForBills: true
  requireForRaiders: true

# Red Hat OpenShift Observability (RHOBS): optional templates deployed to the observability operator namespace.
# When enabled, ThanosQuerier, PodMonitor/ServiceMonitor for the gateway, and UIPlugin are rendered.
# Prerequisites: Cluster Observability Operator, namespace below must exist.
observability:
  rhobs:
    enabled: false
    namespace: openshift-cluster-observability-operator
    thanosQuerier:
      enabled: false
      # partOf label for selector; empty = use topology.applicationName or "nfl-wallet"
      partOfLabel: ""
    podMonitorGateway:
      enabled: false
    serviceMonitorGateway:
      enabled: false
    uiPlugin:
      enabled: false
